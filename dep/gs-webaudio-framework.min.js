"use strict";function gswaFramework(){this.audioContext=new AudioContext,this.sampleGroup=new gswaSampleGroup,this.compositions=[],this.sources=[],this.numberOfSourcesPlaying=0,this.tracks=[],this.on={},this.do={},this.currentComposition=null,this.bpm=60;for(var o in gswaFramework.do)this.do[o]=gswaFramework.do[o].bind(this),this.on[o]=function(){};this.on.setBPMthen=this.on.loadingSource=this.on.endedSource=function(){}}gswaFramework.do={},gswaFramework.do.addSource=function(o){var t=new gswaBufferSample;o.bufferSample=t,t.setMetadata(o.metadata),this.sources.push(o),o.userData=this.on.addSource(o)},gswaFramework.do.addSources=function(o){o.forEach(this.do.addSource),this.on.addSources(o)},gswaFramework.do.loadSource=function(o){var t=this,s=o.bufferSample,i=o.data;if(i)return s.setContext(this.audioContext),s.connect(this.audioContext.destination),this.on.loadingSource(o),("string"==typeof i?s.setDataFromURL(i):s.setDataFromBlob(i)).then(function(){return t.on.loadSource(o),o})},gswaFramework.do.loadSources=function(o){Promise.all(o.map(this.do.loadSource)).then(this.on.loadSources)},gswaFramework.do.playSource=function(o){var t=this,s=o.bufferSample,i=s.start();return++this.numberOfSourcesPlaying,i.addEventListener("ended",function(){--t.numberOfSourcesPlaying,t.on.endedSource(o)}),this.on.playSource(o),i},gswaFramework.do.stopSource=function(o){o.bufferSample.stop(),this.on.stopSource(o)},gswaFramework.do.stopAllSources=function(){this.sources.forEach(this.do.stopSource),this.on.stopAllSources()},gswaFramework.do.addTrack=function(o){this.tracks.push(o),o.userData=this.on.addTrack(o)},gswaFramework.do.removeTrack=function(o){var t=this.tracks.findIndex(function(t){return t===o});t>-1&&(this.tracks.splice(t,1),this.on.removeTrack(o))},gswaFramework.do.addComposition=function(o){this.compositions.push(o),o.userData=this.on.addComposition(o)},gswaFramework.do.removeComposition=function(o){var t=this.compositions.findIndex(function(t){return t===o});t>-1&&(this.compositions.splice(t,1),this.on.removeComposition(o))},gswaFramework.do.loadComposition=function(o){this.currentComposition!==o&&(this.currentComposition=o,this.on.loadComposition(o))},gswaFramework.do.setBPM=function(o,t){function s(o,t){this.sampleGroup.stretch(t/o),this.on.setBPMthen(o)}clearTimeout(this._bpmTimeoutId),o=Math.max(1,Math.min(o,999.999));var i=this.bpm,n=s.bind(this,o,i);this.bpm=o,this.on.setBPM(o),t?this._bpmTimeoutId=setTimeout(n,t):n()},gswaFramework.do.unload=function(){var o=this.currentComposition;o&&(this.currentComposition=null,this.on.unload(o))},gswaFramework.do.play=function(){this.on.play()},gswaFramework.do.pause=function(){this.on.pause()},gswaFramework.do.stop=function(){this.on.stop()};